
<%= form_with(scope: :trade, url: execute_path) do |form| %>
  
  <%= @coin_id.capitalize %>
  <%= number_with_delimiter(@entry_price) %>
  <% if session[:user_id] %>
    <% if @user.wallet %>
        Current Balance <%= @user.wallet.balance %>
    <% end %>
  <% end %>
  
    <p>
      <%= form.label :size, style: "display: block" %>
      <%= form.number_field :size, step: :any %>
    </p>
    <p style="display:none">
      <%= form.label :coin_id, style: "display: block" %>
      <%= form.text_field :coin_id, value:@coin_id %>
      <%= form.label :entry_price, style: "display: block" %>
      <%= form.number_field :entry_price, value:@entry_price %>
    </p>
    <p>
      <%= form.submit "Trade" %>
    </p>
<% end %>
<table>
  <thead>
    <tr>
      <th>Coin</th>
      <th>Quantity</th>
      <th>Mark Price</th>
      <th>Ave Price</th>
      <th>Profit/Loss</th>
      <th>Action</th>
    </tr>
  </thead>
<% if @position.length > 0 %>
  <tbody>
    <% @position.each do |p| %>
      <% @api.each do |api| %>
        <% if p.quantity > 0 && api['id'] === p.coin_id %>
          <tr>
            <td><%= p.coin_id.capitalize %></td>
            <td><%= p.quantity %></td>
            <td><%= number_with_delimiter(api['current_price']) %></td>
            <td><%= number_with_delimiter(p.average_entry.round(4)) %></td>
            <td><%= number_to_currency((api['current_price']-p.average_entry)*p.quantity) %></td>
            <td><%= link_to "Trade Now", trade_path(coin_id: api['id'], entry_price: api['current_price']) %></td>
          </tr>
        <% end %>
      <% end %>
    <% end %>
  </tbody>
<% else %>
  <p>No transactions yet.</p>
<% end %>
</table>